@{
}
@model List<EventModel>



<div class="d-md-flex d-block align-items-center justify-content-between page-breadcrumb mb-3">
    <div class="my-auto mb-2">
        <h2 class="mb-1">Holidays</h2>
        <nav>
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item">
                    <a href="index.html"><i class="ti ti-smart-home"></i></a>
                </li>
                <li class="breadcrumb-item">
                    Event
                </li>
                <li class="breadcrumb-item active" aria-current="page">Holidays List</li>
            </ol>
        </nav>
    </div>
    <div class="d-flex my-xl-auto right-content align-items-center flex-wrap ">
        <div class="me-2">


            <div class="btn-add-event-container">
                <button class="btn btn-primary btn-add-event" id="btnmod" data-bs-toggle="modal">
                    <i class="ti ti-circle-plus me-2"></i>
                    Add Holiday
                </button>

            </div>
        </div>
        <div class="head-icons ms-2">
            <a href="javascript:void(0);" class="" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="Collapse" id="collapse-header">
                <i class="ti ti-chevrons-up"></i>
            </a>
        </div>


        @* <div class="btn-add-event-container">
                <button class="btn btn-primary d-flex align-items-center" id="btnmod" data-bs-toggle="modal">
                    <i class="ti ti-circle-plus me-2"></i> Add Holidays
                </button>
                <div class="head-icons ms-2">
                    <a href="javascript:void(0);" class="" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="Collapse" id="collapse-header">
                        <i class="ti ti-chevrons-up"></i>
                    </a>
                </div>
            </div>

        </div> *@

        @*  <a href="#" data-bs-toggle="modal" id="btnmod" class="btn btn-primary d-flex align-items-center"><i class="ti ti-circle-plus me-2"></i>Add Holiday</a>
         </div>
                <div class="head-icons ms-2">
                    <a href="javascript:void(0);" class="" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="Collapse" id="collapse-header">
                        <i class="ti ti-chevrons-up"></i>
                    </a>
                </div> *@


    </div>
</div>





<div class="modal fade" id="addEventModal" tabindex="-1" aria-labelledby="addEventModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addEventModalLabel">Add New Event</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addEventForm">
                    <div class="mb-3">
                        <label for="eventTitle" class="form-label">Event Title</label>
                        <input type="text" class="form-control" id="eventTitle" required>
                    </div>
                    <div class="mb-3">
                        <label for="eventDate" class="form-label">Event Date</label>
                        <input type="date" class="form-control" id="eventDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="eventType" class="form-label">Event Type</label>
                        <select class="form-control" id="eventType" required>
                            <option value="">Select Event Type</option>
                        </select>
                    </div>
                    <button type="submit" id="savemod" class="btn btn-primary">Add Event</button>

                </form>
            </div>
        </div>
    </div>
</div>
<!-- Edit Event Modal -->
<div class="modal fade" id="editEventModal" tabindex="-1" aria-labelledby="editEventModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editEventModalLabel">Edit Event</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editEventForm">
                    <input type="hidden" id="editEventId">
                    <div class="mb-3">
                        <label for="editEventTitle" class="form-label">Event Title</label>
                        <input type="text" class="form-control" id="editEventTitle" required>
                    </div>
                    <div class="mb-3">
                        <label for="editEventDate" class="form-label">Event Date</label>
                        <input type="date" class="form-control" id="editEventDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="editEventType" class="form-label">Event Type</label>
                        <select class="form-control" id="editEventType" required>
                            <option value="">Select Event Type</option>
                        </select>
                    </div>
                    <button type="submit" id="updateEvent" class="btn btn-primary">Update Event</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header d-flex align-items-center justify-content-between flex-wrap row-gap-3">
        <h5 class="mb-0">Holidays Details</h5>
    </div>

    <div class="card-body">
        <div class="table-responsive">
            <table class="table" id="mytable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var dbEvents in Model)
                    {
                        <tr>

                            <td>@dbEvents.Id</td>
                            <td>@dbEvents.Title</td>
                            <td>@dbEvents.Date.ToString()</td>
                            <td>
                                <span class="badge d-inline-flex align-items-center badge-sm @(dbEvents.Status == "Active" ? "badge-success" : "badge-danger") status-btn"
                                      data-id="@dbEvents.Id" data-status="@dbEvents.Status">
                                    <i class="ti ti-point-filled me-1"></i> @dbEvents.Status
                                </span>

                            </td>
                            <td>
                                <button class="editEventBtn" style="background:none;border:none"
                                        data-id="@dbEvents.Id"
                                        data-title="@dbEvents.Title"
                                        data-date="@dbEvents.Date.ToString()"
                                        data-type="@dbEvents.EventTypeId">
                                    <i class='ti ti-edit'></i>
                                </button>

                                <form asp-action="DeleteSubEvent" asp-route-id="@dbEvents.Id" method="post" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this event?');">
                                    <button type="submit" style="background:none;border:none">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                    } ,
                </tbody>
            </table>
        </div>
    </div>
</div>

@section  Scripts {

    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script>

                $('#mytable').DataTable({
          "paging": true, // Enable pagination
        "pageLength": 5, // Rows per page
        "lengthMenu": [5, 10, 25, 50, 100], // Pagination options
        "ordering": true, // Enable sorting
        "searching": true, // Enable searching
        "info": true, // Show info about total records
        "responsive": true, // Make table responsive
        "autoWidth": false // Avoid automatic column width calculatio

        });
    </script>


                }
<script>
    $(document).ready(function () {
    const $calendarEl = $('#calendar');
    const $eventListEl = $('#eventList');
    const $eventForm = $('#addEventForm');

    // Fetch event types and populate the dropdown
    $.getJSON('/Event/GetEventTypes', function (eventTypes) {
        const $select = $('#eventType');
        $.each(eventTypes, function (index, type) {
            $select.append($('<option>', {
                value: type.id,
                text: type.name
            }));
        });
    });

    $('.editEventBtn').on('click', function () {
                let eventId = $(this).data('id');
                let eventTitle = $(this).data('title');
                let eventDate = $(this).data('date');
                let eventType = $(this).data('type');

                $('#editEventId').val(eventId);
                $('#editEventTitle').val(eventTitle);
                $('#editEventDate').val(eventDate);
                $('#editEventType').val(eventType);

                $('#editEventModal').modal('show');
            });

    $('#btnmod').on('click', function () {
           $('#addEventModal').modal('show');
            });

                   $('#editEventModal').on('show.bs.modal', function () {
        // Clear and repopulate the event type dropdown
        $('#editEventType').empty().append('<option value="">Select Event Type</option>');

        // Fetch event types and set the selected value AFTER populating
          $.getJSON('/Event/GetEventTypes', function (eventTypes) {
            $.each(eventTypes, function (index, type) {
                $('#editEventType').append($('<option>', {
                    value: type.id,
                    text: type.name
                }));
            });

            // Set the selected value AFTER options are populated
            let eventType = $('.editEventBtn').data('type'); // Get the event type ID
            $('#editEventType').val(eventType);
          });

    });
             $('#editEventForm').on('submit', function (e) {
                e.preventDefault();
                let eventId = $('#editEventId').val();
                let eventTitle = $('#editEventTitle').val();
                let eventDate = $('#editEventDate').val();
                let eventTypeId = $('#editEventType').val();

                $.ajax({
                    url: '/Event/EditEvent',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        Id: eventId,
                        Title: eventTitle,
                        Date: eventDate,
                        EventTypeId: parseInt(eventTypeId)
                    }),
                    success: function () {
                        location.reload(); // Refresh page after updating event
                    },
                      error: function (xhr, status, error) {
        console.error('Error:', xhr.responseText);
        alert('Failed to update event.');
    }
                });
            });

    // Event form submission handler
       $('#addEventForm').on('submit', function (e) {
           e.preventDefault();
           if (this.submitting) return;
           this.submitting = true;

           let eventTitle = $('#eventTitle').val();
           let eventDate = $('#eventDate').val();
           let eventTypeId = $('#eventType').val();

           $.ajax({
               url: '/Event/AddEvent',
               method: 'POST',
               contentType: 'application/json',
               data: JSON.stringify({
                   Title: eventTitle,
                   Date: eventDate,
                   EventTypeId: parseInt(eventTypeId)
               }),
               success: function (newEvent) {
                   location.reload(); // Refresh the page after successful event addition
               },
               error: function () {
                   alert('Failed to add event.');
                   this.submitting = false;
               }
           });
       });
           $(".status-btn").click(function () {
        let badge = $(this);
        let eventId = badge.data("id");
        let currentStatus = badge.data("status");

        $.ajax({
            url: "/Event/ToggleStatus",
            method: "POST",
            data: { id: eventId },
            success: function (response) {
                // Update badge data and text
                badge.data("status", response.status);
                badge.html(`<i class="ti ti-point-filled me-1"></i> ${response.status}`);

                // Toggle badge color
                if (response.status === "Active") {
                    badge.removeClass("badge-danger").addClass("badge-success");
                } else {
                    badge.removeClass("badge-success").addClass("badge-danger");
                }
            },
            error: function () {
                alert("Failed to update status.");
            }
        });


    });
    });
</script>
