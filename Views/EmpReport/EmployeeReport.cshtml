@model List<Pulse360.Models.User>
@{
	ViewData["Title"] = "Employee Report";
	var totalUsers = ViewBag.TotalUsers;
	var activeUsers = ViewBag.ActiveUsers;
	var departmentsCount = ViewBag.DepartmentsCount;
	// var rolesCount = ViewBag.RolesCount;
	var chartLabels = ViewBag.ChartLabels as int[] ?? new int[] { };
	var chartData = ViewBag.ChartData as int[] ?? new int[] { };
}
<!-- Breadcrumb -->

<div class="d-md-flex d-block align-items-center justify-content-between page-breadcrumb mb-3">
	<div class="my-auto mb-2">
		<h2 class="mb-1">Employee Report</h2>
		<nav>
			<ol class="breadcrumb mb-0">
				<li class="breadcrumb-item">
					<a href="index.html"><i class="ti ti-smart-home"></i></a>
				</li>
				<li class="breadcrumb-item">
					HR
				</li>
				<li class="breadcrumb-item active" aria-current="page">Employee Report</li>
			</ol>
		</nav>
	</div>
	<div class="d-flex my-xl-auto right-content align-items-center flex-wrap ">
		<div class="mb-2">
			<div class="dropdown">
				<a href="javascript:void(0);" class="dropdown-toggle btn btn-white d-inline-flex align-items-center" data-bs-toggle="dropdown">
					<i class="ti ti-file-export me-1"></i>Export
				</a>
				<ul class="dropdown-menu  dropdown-menu-end p-3">
					<li>
						<a asp-action="EmpExportToPDF" asp-controller="EmpReport" class="dropdown-item rounded-1"><i class="ti ti-file-type-pdf me-1"></i>Export as PDF</a>
					</li>
					<li>
						<a asp-action="EmpExportToCSV" asp-controller="EmpReport" class="dropdown-item rounded-1"><i class="ti ti-file-type-xls me-1"></i>Export as Excel </a>
					</li>
				</ul>
			</div>

		</div>
		<div class="head-icons ms-2">
			<a href="javascript:void(0);" class="" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="Collapse" id="collapse-header">
				<i class="ti ti-chevrons-up"></i>
			</a>
		</div>
	</div>
</div>
<!-- /Breadcrumb -->
<div class="row">
	<div class="col-xl-6 d-flex">
		<div class="row flex-fill">

			<!-- Total Companies -->
			<div class="col-lg-6 col-md-6 d-flex">
				<div class="card flex-fill">
					<div class="card-body">
						<div class="overflow-hidden d-flex mb-2 align-items-center">
							<span class="me-2"><img src="/assets/img/reports-img/employee-report-icon.svg" alt="Img" class="img-fluid"></span>
							<div>
								<p class="fs-14 fw-normal mb-1 text-truncate">Total Employee</p>
								<h5>@totalUsers</h5>
							</div>
						</div>
						<div>
							<p class="fs-12 fw-normal d-flex align-items-center text-truncate "><span class="text-success fs-12 d-flex align-items-center me-1"><i class="ti ti-arrow-wave-right-up me-1"></i>+20.01%</span>from last week</p>
						</div>
					</div>
				</div>
			</div>
			<!-- /Total Companies -->
			<!-- Total Companies -->
			<div class="col-lg-6 col-md-6 d-flex">
				<div class="card flex-fill">
					<div class="card-body">
						<div class="overflow-hidden d-flex mb-2 align-items-center">
							<span class="me-2"><img src="/assets/img/reports-img/employee-report-success.svg" alt="Img" class="img-fluid"></span>
							<div>
								<p class="fs-14 fw-normal mb-1 text-truncate">Total Department</p>
								<h5>@departmentsCount</h5>
							</div>
						</div>
						<div>
							<p class="fs-12 fw-normal d-flex align-items-center text-truncate "><span class="text-success fs-12 d-flex align-items-center me-1"><i class="ti ti-arrow-wave-right-up me-1"></i>+20.01%</span>from last week</p>
						</div>
					</div>
				</div>
			</div>
			<!-- /Total Companies -->
			<!-- Inactive Companies -->
			<div class="col-lg-6 col-md-6 d-flex">
				<div class="card flex-fill">
					<div class="card-body">
						<div class="overflow-hidden d-flex mb-2 align-items-center">
							<span class="me-2"><img src="/assets/img/reports-img/employee-report-info.svg" alt="Img" class="img-fluid"></span>
							<div>
								<p class="fs-14 fw-normal mb-1 text-truncate">Active Employee</p>
								<h5>@activeUsers</h5>
							</div>
						</div>
						<div>
							<p class="fs-12 fw-normal d-flex align-items-center text-truncate "><span class="text-success fs-12 d-flex align-items-center me-1"><i class="ti ti-arrow-wave-right-up me-1"></i>+20.01%</span>from last week</p>
						</div>
					</div>
				</div>
			</div>
			<!-- /Inactive Companies -->
			<!-- Company Location -->
			<div class="col-lg-6 col-md-6 d-flex">
				<div class="card flex-fill">
					<div class="card-body">
						<div class="overflow-hidden d-flex mb-2 align-items-center">
							<span class="me-2"><img src="/assets/img/reports-img/employee-report-danger.svg" alt="Img" class="img-fluid"></span>
							<div>
								<p class="fs-14 fw-normal mb-1 text-truncate">Roles</p>
								<h5>@ViewBag.RolesCount</h5>
							</div>
						</div>
						<div>
							<p class="fs-12 fw-normal d-flex align-items-center text-truncate "><span class="text-success fs-12 d-flex align-items-center me-1"><i class="ti ti-arrow-wave-right-up me-1"></i>+20.01%</span>from last week</p>
						</div>
					</div>
				</div>
			</div>
			<!-- /Company Location -->
		</div>
	</div>
	<div class="col-xl-6 d-flex">
		<div class="card flex-fill">
			<div class="card-header border-0 pb-0">
				<div class="d-flex flex-wrap justify-content-between align-items-center row-gap-2">
					<div class="d-flex align-items-center ">
						<span class="me-2"><i class="ti ti-chart-bar text-danger"></i></span>
						<h5>Employee </h5>
					</div>
					<div class="d-flex align-items-center">
						<p class="d-inline-flex align-items-center me-3 mb-0">
							<i class="ti ti-square-filled fs-12 text-success me-2"></i>
							Active Employees
						</p>
						<p class="d-inline-flex align-items-center">
							<i class="ti ti-square-filled fs-12 text-gray-1 me-2 mb-0"></i>
							Inactive Employees
						</p>
					</div>
					<div class="dropdown">
						<a href="javascript:void(0);" class="dropdown-toggle btn btn-sm fs-12 btn-white d-inline-flex align-items-center" data-bs-toggle="dropdown">
							This Year
						</a>
						<ul class="dropdown-menu  dropdown-menu-end p-2">
							<li>
								<a href="javascript:void(0);" class="dropdown-item rounded-1">2024</a>
							</li>
							<li>
								<a href="javascript:void(0);" class="dropdown-item rounded-1">2023</a>
							</li>
							<li>
								<a href="javascript:void(0);" class="dropdown-item rounded-1">2022</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<div class="card-body py-0">
				<div>
					<canvas id="barChart"></canvas>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="card">
	<div class="card-header d-flex align-items-center justify-content-between flex-wrap row-gap-3">
		<h5>Employees List</h5>
		<div class="d-flex my-xl-auto right-content align-items-center flex-wrap row-gap-3">

			<div class="dropdown me-3">

				<select class="form-select form-select-sm me-3" id="statusFilter" onchange="sortTable();">
					<option value="active">Active</option>
					<option value="inactive">Inactive</option>
				</select>

			</div>
			<div class="dropdown">

				<select class="form-select form-select-sm me-3" id="sortFilter" onchange="sortTable();">

					<option value="recent">Recently Added</option>
					<option value="asc">Ascending</option>
					<option value="desc">Descending</option>
					<option value="lastMonth">Last Month</option>
					<option value="last7Days">Last 7 Days</option>
				</select>
			</div>
		</div>
	</div>
</div>

<div class="card-body p-0">

	<div class=" custom-datatable-filter table-responsive">
		<table class="table" id="EmpTableId">
			<thead class="thead-light">
				<tr>
					<th>UserId</th>
					<th>Name</th>
					<th>Email</th>
					<th>Department</th>
					<th>PhoneNumber</th>
					<th>Date of Joining</th>
					<th>Status</th>
				</tr>
			</thead>
			<tbody>
				
					@foreach (var e in Model)
					{
						<tr>
							<td>@e.UserId</td>
							<td>
								<div class="d-flex align-items-center">
									<img src="/@e.ProfilePicture" alt="Profile" class="rounded-circle" width="40" height="40" />

									<div class="ms-2">
										<strong>@e.FirstName @e.LastName</strong>
									@* <div class="text-muted">@(user != null ? user.Departments.Name : "No Department")</div> *@
									</div>
								</div>
							</td>
							<td>@e.Email</td>
							<td>@e.Department.Name</td>
							<td>@e.PhoneNumber</td>
							<td>@e.DateOfJoining</td>
							<td>
								@if (e.Status == "Active")
								{
									<span class="badge badge-success d-inline-flex align-items-center badge-xs">
										<i class="ti ti-point-filled me-1"></i>Active
									</span>
								}
								else if (e.Status == "Inactive")
								{
									<span class="badge badge-danger d-inline-flex align-items-center badge-xs">
										<i class="ti ti-point-filled me-1"></i>Deactive
									</span>
								}
							</td>

						</tr>
					}
					
				
				

			</tbody>
		</table>
	</div>
</div>
@section Scripts {
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
	<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
	<script>
			$(document).ready(function () {
			$('.datatable').DataTable(); // Ensure class matches table
		});
	</script>
	<script>
		const ctx = document.getElementById('barChart').getContext('2d');
		const barChart = new Chart
		(ctx, {
			type: 'bar',
			data:
			{
				labels: @Html.Raw(Json.Serialize(ViewBag.ChartLabels)),
				datasets:
				[
					{
						label: 'Active Users',
						data: @Html.Raw(Json.Serialize(ViewBag.ActiveData)),
						backgroundColor: 'rgba(75, 192, 75, 0.6)', // Green
						borderColor: 'rgba(75, 192, 75, 1)',
						borderWidth: 1
					},
					{
						label: 'Inactive Users',
						data: @Html.Raw(Json.Serialize(ViewBag.InactiveData)),
						backgroundColor: 'rgba(128, 128, 128, 0.6)', // Grey
						borderColor: 'rgba(128, 128, 128, 1)',
						borderWidth: 1
					}
				]
			},
			options:
			{
				responsive: true,
				plugins:
				{
					legend:
					{
						display:false,
						position: 'top'

					}
				},
				scales:
				{
					x:
					{
						stacked: false
					},
					y:
					{
						beginAtZero: true,
						ticks:
						{
							stepSize: 10
						}
					}
				}
			}
		});
	</script>
	<!-- DataTables JS -->


	<script>

				function filterTable() {
			let searchText = document.getElementById("searchInput").value.toLowerCase();
			let selectedStatus = document.getElementById("statusFilter").getAttribute("data-selected-status") || "All";
			let table = document.getElementById("EmpTableId");
			let rows = table.getElementsByTagName("tr");

			for (let i = 1; i < rows.length; i++) {
				let row = rows[i];
				let cells = row.getElementsByTagName("td");
				let rowMatches = false;
				let statusCell = cells[2];


				for (let j = 0; j < cells.length; j++) {
					if (cells[j].textContent.toLowerCase().includes(searchText)) {
						rowMatches = true;
						break;
					}
				}


				if (selectedStatus && selectedStatus !== "All") {
					if (!statusCell || statusCell.textContent.trim() !== selectedStatus) {
						rowMatches = false;
					}
				}

				row.style.display = rowMatches ? "" : "none";
			}
		}

			function sortTable() {
			const sortValue = document.getElementById("sortFilter").value;
			const table = document.getElementById("EmpTableId");
			const rows = Array.from(table.getElementsByTagName("tr")).slice(1);


			rows.sort((rowA, rowB) => {
				const cellA = rowA.getElementsByTagName("td")[1].textContent;
				const cellB = rowB.getElementsByTagName("td")[1].textContent;

				switch (sortValue) {
					case "asc":
						return cellA.localeCompare(cellB);
					case "desc":
						return cellB.localeCompare(cellA);
					case "recent":

						const dateA = new Date(rowA.getElementsByTagName("td")[0].textContent);
						const dateB = new Date(rowB.getElementsByTagName("td")[0].textContent);
						return dateB - dateA;
					case "last7Days":
					case "lastMonth":
						// Filter rows based on date range (handled in backend)
						return 0;
					default:
						return 0;
				}
			});


			rows.forEach(row => table.appendChild(row));
		}
	</script>

	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">

	<!-- jQuery -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

	<!-- DataTables JS -->
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
	<script>
		$(document).ready(function() {
			// Initialize DataTables
		$('#EmpTableId').DataTable({
				"paging": true,    // Enable pagination
				"searching": true, // Enable search functionality
				"ordering": true,  // Enable sorting
				"info": true,      // Display information
				"pageLength": 10,   // Default number of rows per page
			});
		});
	</script>


}
