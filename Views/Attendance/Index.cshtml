@model Pulse360.Models.Attendance
@{

	var attendanceList = (List<Pulse360.Models.Attendance>)ViewData["AttendanceList"];
}


@if (TempData["ErrorMessage"] != null)
{
	<div class="alert alert-danger">
		@TempData["ErrorMessage"]
	</div>
}



<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
	<meta name="description" content="Smarthr - Bootstrap Admin Template">
	<meta name="keywords" content="admin, estimates, bootstrap, business, html5, responsive, Projects">
	<meta name="author" content="Dreams technologies - Bootstrap Admin Template">
	<meta name="robots" content="noindex, nofollow">
	<title>Smarthr Admin Template</title>

	<!-- Favicon -->
	<link rel="shortcut icon" type="image/x-icon" href="assets/img/favicon.png">

	<!-- Apple Touch Icon -->
	<link rel="apple-touch-icon" sizes="180x180" href="assets/img/apple-touch-icon.png">

	<!-- Theme Script js -->
	<script src="assets/js/theme-script.js"></script>

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="assets/css/bootstrap.min.css">

	<!-- Feather CSS -->
	<link rel="stylesheet" href="assets/plugins/icons/feather/feather.css">

	<!-- Tabler Icon CSS -->
	<link rel="stylesheet" href="assets/plugins/tabler-icons/tabler-icons.css">

	<!-- Select2 CSS -->
	<link rel="stylesheet" href="assets/plugins/select2/css/select2.min.css">

	<!-- Fontawesome CSS -->
	<link rel="stylesheet" href="assets/plugins/fontawesome/css/fontawesome.min.css">
	<link rel="stylesheet" href="assets/plugins/fontawesome/css/all.min.css">

	<!-- Datetimepicker CSS -->
	<link rel="stylesheet" href="assets/css/bootstrap-datetimepicker.min.css">

	<!-- Color Picker Css -->
	<link rel="stylesheet" href="assets/plugins/flatpickr/flatpickr.min.css">


	<!-- Daterangepikcer CSS -->
	<link rel="stylesheet" href="assets/plugins/daterangepicker/daterangepicker.css">

	<!-- Datatable CSS -->
	<link rel="stylesheet" href="assets/css/dataTables.bootstrap5.min.css">

	<!-- Select2 CSS -->
	<link rel="stylesheet" href="assets/plugins/select2/css/select2.min.css">

	<!-- Main CSS -->
	<link rel="stylesheet" href="assets/css/style.css">


	<script src="~/lib/jquery/dist/jquery.min.js"></script>
	@* <script src="~/lib/jquery/dist/jquery.js"></script> *@
	<script src="~/js/attendance.js"></script>

</head>

<body>


	<div id="global-loader" style="display: none;">
		<div class="page-loader"></div>
	</div>

	<!-- Main Wrapper -->
	<div class="main-wrapper">


		<div class="content">

			<!-- Breadcrumb -->
			<div class="d-md-flex d-block align-items-center justify-content-between page-breadcrumb mb-3">
				<div class="my-auto mb-2">
					<h2 class="mb-1">Employee Attendance</h2>
				</div>
				<div class="d-flex my-xl-auto right-content align-items-center flex-wrap ">

					<div class="me-2 mb-2">
						<div class="dropdown">
							<a href="javascript:void(0);" class="dropdown-toggle btn btn-white d-inline-flex align-items-center" data-bs-toggle="dropdown">
								<i class="ti ti-file-export me-1"></i>Export
							</a>
							<ul class="dropdown-menu  dropdown-menu-end p-3">
								<li>
									<a href="javascript:void(0);" class="dropdown-item rounded-1" onclick="exportToPDF()"><i class="ti ti-file-type-pdf me-1"></i>Export as PDF</a>
								</li>
								<li>
									<a href="javascript:void(0);" class="dropdown-item rounded-1" onclick="exportToExcel()"><i class="ti ti-file-type-xls me-1"></i>Export as Excel </a>
								</li>
							</ul>
						</div>
					</div>
					<div class="mb-2">
						<a href="#" class="btn btn-primary d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#attendance_report"><i class="ti ti-file-analytics me-2"></i>Report</a>
					</div>
					<div class="ms-2 head-icons">
						<a href="javascript:void(0);" class="" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="Collapse" id="collapse-header">
							<i class="ti ti-chevrons-up"></i>
						</a>
					</div>
				</div>
			</div>
			<!-- /Breadcrumb -->

			<div class="row">
				<div class="col-xl-3 col-lg-4 d-flex">
					<div class="card flex-fill">
						<div class="card-body">
							<div class="mb-3 text-center">
								<h6 class="fw-medium text-gray-5 mb-2">Good Morning, @ViewBag.User.FirstName</h6>
								<h4>@ViewBag.CurrentTime, @(Model?.Date.ToString("dd MMM yyyy") ?? "No Date Available")</h4>
							</div>
							<div class="attendance-circle-progress mx-auto mb-3" data-value='65'>
								<span class="progress-left">
									<span class="progress-bar border-success"></span>
								</span>
								<span class="progress-right">
									<span class="progress-bar border-success"></span>
								</span>
								<div class="avatar avatar-xxl avatar-rounded">
									<img src="/@ViewBag.User.ProfilePicture" alt="User Image" height="30" weight="30">
								</div>
							</div>
							<div class="text-center">
								<div class="badge badge-md badge-primary mb-3">Production :  <p>@(ViewBag.ProductionFormatted ?? "0h:0m")</p> </div>
								<h6 class="fw-medium d-flex align-items-center justify-content-center mb-3">
									<i class="ti ti-fingerprint text-primary me-1"></i>
									Punch In at <strong>@(Model?.CheckIn?.ToString("hh:mm tt") ?? "Not Checked In")</strong>
								</h6>

								<div class="text-center mt-4">
									<form id="attendanceForm" asp-action="MarkAttendance" asp-controller="Attendance" method="post">
										<button type="submit" id="attendanceBtn" class="btn btn-primary btn-lg">
											@ViewBag.AttendanceStatus
										</button>
									</form>
								</div>

							</div>

						</div>
					</div>
				</div>
				<div class="col-xl-9 col-lg-8 d-flex">
					<div class="row flex-fill">
						<div class="col-xl-3 col-md-6">
							<div class="card">
								<div class="card-body">
									<div class="border-bottom mb-2 pb-2">
										<span class="avatar avatar-sm bg-primary mb-2"><i class="ti ti-clock-stop"></i></span>
										<h2 class="mb-2">  <span class="fs-20 text-gray-5"> @(ViewBag.TotalWorkingHoursToday ?? "Default") </span></h2>
										<p class="fw-medium text-truncate">Total Hours Today</p>
									</div>
									<div>
										<p class="d-flex align-items-center fs-13">
											<span class="avatar avatar-xs rounded-circle bg-success flex-shrink-0 me-2">
												<i class="ti ti-arrow-up fs-12"></i>
											</span>
											<span>Today</span>
										</p>
									</div>
								</div>
							</div>
						</div>
						<div class="col-xl-3 col-md-6">
							<div class="card">
								<div class="card-body">
									<div class="border-bottom mb-2 pb-2">
										<span class="avatar avatar-sm bg-dark mb-2"><i class="ti ti-clock-up"></i></span>
										<h2 class="mb-2">  <span class="fs-20 text-gray-5"> @(ViewBag.TotalWorkingHoursWeek ?? "Default") </span></h2>
										<p class="fw-medium text-truncate">Total Hours Week</p>
									</div>
									<div>
										<p class="d-flex align-items-center fs-13">
											<span class="avatar avatar-xs rounded-circle bg-success flex-shrink-0 me-2">
												<i class="ti ti-arrow-up fs-12"></i>
											</span>
											<span>Last Week</span>
										</p>
									</div>
								</div>
							</div>
						</div>
						<div class="col-xl-3 col-md-6">
							<div class="card">
								<div class="card-body">
									<div class="border-bottom mb-2 pb-2">
										<span class="avatar avatar-sm bg-info mb-2"><i class="ti ti-calendar-up"></i></span>
										<h2 class="mb-2">   <span class="fs-20 text-gray-5"> @(ViewBag.TotalWorkingHoursMonth ?? "Default") </span></h2>
										<p class="fw-medium text-truncate">Total Hours Month</p>
									</div>
									<div>
										<p class="d-flex align-items-center fs-13 text-truncate">
											<span class="avatar avatar-xs rounded-circle bg-danger flex-shrink-0 me-2">
												<i class="ti ti-arrow-down fs-12"></i>
											</span>
											<span>Last Month</span>
										</p>
									</div>
								</div>
							</div>
						</div>
						<div class="col-xl-3 col-md-6">
							<div class="card">
								<div class="card-body">
									<div class="border-bottom mb-2 pb-2">
										<span class="avatar avatar-sm bg-pink mb-2"><i class="ti ti-calendar-star"></i></span>
										<h2 class="mb-2"><span class="fs-20 text-gray-5"> @(ViewBag.OvertimeThisMonth ?? "Default")</span></h2>
										<p class="fw-medium text-truncate">Overtime this Month</p>
									</div>
									<div>
										<p class="d-flex align-items-center fs-13 text-truncate">
											<span class="avatar avatar-xs rounded-circle bg-danger flex-shrink-0 me-2">
												<i class="ti ti-arrow-down fs-12"></i>
											</span>
											<span>Last Month</span>
										</p>
									</div>
								</div>
							</div>
						</div>
						<div class="col-md-12">
							<div class="card">
								<div class="card-body">
									<div class="row">
										<div class="col-xl-3">
											<div class="mb-3">
												<p class="d-flex align-items-center mb-1"><i class="ti ti-point-filled text-dark-transparent me-1"></i>Total Working hours</p>
												<h3>@(ViewBag.WorkingFormatted ?? "0h:0m")</h3>
											</div>
										</div>
										<div class="col-xl-3">
											<div class="mb-3">
												<p class="d-flex align-items-center mb-1"><i class="ti ti-point-filled text-success me-1"></i>Productive Hours</p>
												<h3>@(ViewBag.ProductionFormatted ?? "0h:0m")</h3>
											</div>
										</div>
										<div class="col-xl-3">
											<div class="mb-3">
												<p class="d-flex align-items-center mb-1"><i class="ti ti-point-filled text-warning me-1"></i>Break hours</p>
												<h3>@(ViewBag.BreakFormatted ?? "0h:0m")</h3>
											</div>
										</div>
										<div class="col-xl-3">
											<div class="mb-3">
												<p class="d-flex align-items-center mb-1"><i class="ti ti-point-filled text-info me-1"></i>Overtime</p>
												<h3>@(ViewBag.OvertimeFormatted ?? "0h 0m")</h3>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="col-md-12">
											<div class="progress bg-transparent-dark mb-3" style="height: 24px;">
												<div class="progress-bar bg-white rounded" role="progressbar" style="width: 18%;"></div>
												<div class="progress-bar bg-success rounded me-2" role="progressbar" style="width: 18%;"></div>
												<div class="progress-bar bg-warning rounded me-2" role="progressbar" style="width: 5%;"></div>
												<div class="progress-bar bg-success rounded me-2" role="progressbar" style="width: 28%;"></div>
												<div class="progress-bar bg-warning rounded me-2" role="progressbar" style="width: 17%;"></div>
												<div class="progress-bar bg-success rounded me-2" role="progressbar" style="width: 22%;"></div>
												<div class="progress-bar bg-warning rounded me-2" role="progressbar" style="width: 5%;"></div>
												<div class="progress-bar bg-info rounded me-2" role="progressbar" style="width: 3%;"></div>
												<div class="progress-bar bg-info rounded" role="progressbar" style="width: 2%;"></div>
												<div class="progress-bar bg-white rounded" role="progressbar" style="width: 18%;"></div>
											</div>

										</div>
										<div class="co-md-12">
											<div class="d-flex align-items-center justify-content-between flex-wrap row-gap-2">
												<span class="fs-10">06:00</span>
												<span class="fs-10">07:00</span>
												<span class="fs-10">08:00</span>
												<span class="fs-10">09:00</span>
												<span class="fs-10">10:00</span>
												<span class="fs-10">11:00</span>
												<span class="fs-10">12:00</span>
												<span class="fs-10">01:00</span>
												<span class="fs-10">02:00</span>
												<span class="fs-10">03:00</span>
												<span class="fs-10">04:00</span>
												<span class="fs-10">05:00</span>
												<span class="fs-10">06:00</span>
												<span class="fs-10">07:00</span>
												<span class="fs-10">08:00</span>
												<span class="fs-10">09:00</span>
												<span class="fs-10">10:00</span>
												<span class="fs-10">11:00</span>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="card">
				<div class="card-header d-flex align-items-center justify-content-between flex-wrap row-gap-3">
					<h5>Employee Attendance</h5>
					<div class="d-flex my-xl-auto right-content align-items-center flex-wrap row-gap-3">

						<div class="d-flex mb-1">
							<div class="d-flex align-items-center me-1">
								<label for="startDate" class="me-2">Start:</label>
								<input type="date" class="form-control" id="startDate" onchange="filterTable()">
							</div>
							<div class="d-flex align-items-center me-3">
								<label for="endDate" class="me-2">End:</label>
								<input type="date" class="form-control" id="endDate" onchange="filterTable()">
							</div>
						</div>


						<div class="dropdown me-3">
							<a href="javascript:void(0);" class="dropdown-toggle btn btn-white d-inline-flex align-items-center" data-bs-toggle="dropdown" id="statusFilter">
								Select Status
							</a>
							<ul class="dropdown-menu  dropdown-menu-end p-3">

								<li>
									<a href="javascript:void(0);" class="dropdown-item rounded-1" data-status="All">All</a>
								</li>
								<li>
									<a href="javascript:void(0);" class="dropdown-item rounded-1" data-status="Present">Present</a>
								</li>
								<li>
									<a href="javascript:void(0);" class="dropdown-item rounded-1" data-status="Absent">Absent</a>
								</li>
								<li>
									<a href="javascript:void(0);" class="dropdown-item rounded-1" data-status="Half Day">Half Day</a>
								</li>
							</ul>
						</div>
						<div class="dropdown me-3">


							<select class="form-select form-select-sm me-3" id="sortFilter" onchange="sortTable();">

								<option value="recent">Recently Added</option>
								<option value="asc">Ascending</option>
								<option value="desc">Descending</option>
								<option value="lastMonth">Last Month</option>
								<option value="last7Days">Last 7 Days</option>
							</select>
						</div>
					</div>
				</div>

				<div>

					<div class="d-flex justify-content-between align-items-center mb-3">
						<!-- Left Side: Rows Per Page -->
						<div class="d-flex align-items-center">
							<label class="me-3">Row</label>
							<select class="form-select form-select-sm me-3" id="rowsPerPage" onchange="paginateTable();">
								<option value="10">10</option>
								<option value="25">25</option>
								<option value="50">50</option>
								<option value="100">100</option>
							</select>
							<span>Entries</span>
						</div>

						<!-- Right Side: Search Bar -->
						<div style="width: 200px;">
							<input type="text" class="form-control form-control-sm" id="searchInput" placeholder="Search" oninput="filterTable();">
						</div>
					</div>

					<div class="card-body p-0">
						<div class="custom-datatable-filter table-responsive">

							@if (attendanceList != null && attendanceList.Any())
							{
								<table class="table" id="attendanceTable">
									<thead class="thead-light">
										<tr>
											<th>Date</th>
											<th>Check In</th>
											<th>Status</th>
											<th>Check Out</th>
											<th>Break</th>
											<th>Late</th>
											<th>Overtime</th>
											<th>Production Hours</th>

										</tr>
									</thead>
									<tbody id="attendanceList">
										@foreach (var record in attendanceList)
										{
											<tr>
												<td>@record.Date.ToString("yyyy/MM/dd")</td>
												<td>@record.CheckIn?.ToString("hh:mm tt")</td>
												<td>
													@if (record.Status == "Present")
													{
														<span class="badge badge-success d-inline-flex align-items-center badge-xs">
															<i class="ti ti-point-filled me-1"></i>Present
														</span>
													}
													else if (record.Status == "Absent")
													{
														<span class="badge badge-danger d-inline-flex align-items-center badge-xs">
															<i class="ti ti-point-filled me-1"></i>Absent
														</span>
													}
													else if (record.Status == "Half Day")
													{
														<span class="badge badge-warning d-inline-flex align-items-center badge-xs">
															<i class="ti ti-point-filled me-1"></i>Half Day
														</span>
													}
												</td>



												@* <td>@record.Status</td> *@
												<td>@record.CheckOut?.ToString("hh:mm tt")</td>
												<td>@record.BreakHours hrs</td>
												<td>@record.Late min</td>
												<td>@record.OvertimeHours hrs</td>


												<td>
													@{
														var productionHours = record.ProductionHours; // Ensure ProductionHours is a TimeSpan
													}
													@if (productionHours < 4)
													{
														<span class="badge badge-danger d-inline-flex align-items-center badge-xs">
															<i class="ti ti-point-filled me-1"></i>@(record.ProductionHours)
														</span>
													}
													else
													{
														<span class="badge badge-success d-inline-flex align-items-center badge-xs">
															<i class="ti ti-point-filled me-1"></i>@(record.ProductionHours)
														</span>
													}
												</td>
												@* <td>@record.ProductionHours hrs</td> *@

											</tr>
										}
									</tbody>
								</table>
							}
							else
							{
								<p>No attendance records found for the selected filters.</p>
							}


						</div>
					</div>

				</div>

			</div>

		</div>

		<div class="footer d-sm-flex align-items-center justify-content-between border-top bg-white p-3">
			<p class="mb-0">2014 - 2025 &copy; SmartHR.</p>
			<p>Designed &amp; Developed By <a href="javascript:void(0);" class="text-primary">Dreams</a></p>
		</div>

	</div>
	<!-- /Page Wrapper -->
	<!-- Attendance Report -->

	<div class="modal fade" id="attendance_report">
		<div class="modal-dialog modal-dialog-centered modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">Attendance</h4>
					<button type="button" class="btn-close custom-btn-close" data-bs-dismiss="modal" aria-label="Close">
						<i class="ti ti-x"></i>
					</button>
				</div>
				<div class="modal-body">
					<div class="card shadow-none bg-transparent-light">
						<div class="card-body pb-1">
							<div class="row">
								<div class="col-sm-3">
									<div class="mb-3">
										<span>Date</span>
										<p> <strong>@(Model?.Date.ToString("dd MMM yyyy") ?? "No Date Available")</strong> </p>
									</div>
								</div>
								<div class="col-sm-3">
									<div class="mb-3">
										<span>Punch in at    </span>
										<p><strong>@(Model?.CheckIn?.ToString("hh:mm tt") ?? "Not Checked In")</strong></p>

									</div>
								</div>
								<div class="col-sm-3">
									<div class="mb-3">
										<span>Punch out at</span>
										<p><strong>@(Model?.CheckOut?.ToString("hh:mm tt") ?? "Not Checked In")</strong></p>
									</div>
								</div>
								<div class="col-sm-3">
									<div class="mb-3">
										<span>Status</span>
										<p><strong>@(Model?.Status ?? "Status Not Available")</strong></p>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="card shadow-none border mb-0">
						<div class="card-body">
							<div class="row">
								<div class="col-xl-3">
									<div class="mb-4">
										<p class="d-flex align-items-center mb-1"><i class="ti ti-point-filled text-dark-transparent me-1"></i>Total Working hours</p>
										<h3>@(ViewBag.WorkingFormatted ?? "0h:0m")</h3>
									</div>
								</div>
								<div class="col-xl-3">
									<div class="mb-4">
										<p class="d-flex align-items-center mb-1"><i class="ti ti-point-filled text-success me-1"></i>Productive Hours</p>
										<h3>@(ViewBag.ProductionFormatted ?? "0h:0m")</h3>
									</div>
								</div>
								<div class="col-xl-3">
									<div class="mb-4">
										<p class="d-flex align-items-center mb-1"><i class="ti ti-point-filled text-warning me-1"></i>Break hours</p>
										<h3>@(ViewBag.BreakFormatted ?? "0h:0m")</h3>
									</div>
								</div>
								<div class="col-xl-3">
									<div class="mb-4">
										<p class="d-flex align-items-center mb-1"><i class="ti ti-point-filled text-info me-1"></i>Overtime</p>
										<h3>@(ViewBag.OvertimeFormatted ?? "0h:0m")</h3>
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col-md-8 mx-auto">
									<div class="progress bg-transparent-dark mb-3" style="height: 24px;">
										<div class="progress-bar bg-success rounded me-2" role="progressbar" style="width: 18%;"></div>
										<div class="progress-bar bg-warning rounded me-2" role="progressbar" style="width: 5%;"></div>
										<div class="progress-bar bg-success rounded me-2" role="progressbar" style="width: 28%;"></div>
										<div class="progress-bar bg-warning rounded me-2" role="progressbar" style="width: 17%;"></div>
										<div class="progress-bar bg-success rounded me-2" role="progressbar" style="width: 22%;"></div>
										<div class="progress-bar bg-warning rounded me-2" role="progressbar" style="width: 5%;"></div>
										<div class="progress-bar bg-info rounded me-2" role="progressbar" style="width: 3%;"></div>
										<div class="progress-bar bg-info rounded" role="progressbar" style="width: 2%;"></div>
									</div>

								</div>
								<div class="co-md-12">
									<div class="d-flex align-items-center justify-content-between">
										<span class="fs-10">06:00</span>
										<span class="fs-10">07:00</span>
										<span class="fs-10">08:00</span>
										<span class="fs-10">09:00</span>
										<span class="fs-10">10:00</span>
										<span class="fs-10">11:00</span>
										<span class="fs-10">12:00</span>
										<span class="fs-10">01:00</span>
										<span class="fs-10">02:00</span>
										<span class="fs-10">03:00</span>
										<span class="fs-10">04:00</span>
										<span class="fs-10">05:00</span>
										<span class="fs-10">06:00</span>
										<span class="fs-10">07:00</span>
										<span class="fs-10">08:00</span>
										<span class="fs-10">09:00</span>
										<span class="fs-10">10:00</span>
										<span class="fs-10">11:00</span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- /Attendance Report -->
	<!-- jQuery -->
	<script src="assets/js/jquery-3.7.1.min.js"></script>

	<!-- Bootstrap Core JS -->
	<script src="assets/js/bootstrap.bundle.min.js"></script>

	<!-- Feather Icon JS -->
	<script src="assets/js/feather.min.js"></script>

	<!-- Slimscroll JS -->
	<script src="assets/js/jquery.slimscroll.min.js"></script>


	<!-- Datatable JS -->
	<script src="assets/js/jquery.dataTables.min.js"></script>
	<script src="assets/js/dataTables.bootstrap5.min.js"></script>

	<!-- Daterangepikcer JS -->
	<script src="assets/js/moment.js"></script>
	<script src="assets/plugins/daterangepicker/daterangepicker.js"></script>
	<script src="assets/js/bootstrap-datetimepicker.min.js"></script>

	<!-- Select2 JS -->
	<script src="assets/plugins/select2/js/select2.min.js"></script>

	<!-- Chart JS -->
	<script src="assets/plugins/apexchart/apexcharts.min.js"></script>
	<script src="assets/plugins/apexchart/chart-data.js"></script>

	<!-- Custom JS -->
	<script src="assets/js/circle-progress.js"></script>
	<script src="assets/js/theme-colorpicker.js"></script>
	<script src="assets/js/script.js"></script>

	<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>


	<script>

			document.addEventListener("DOMContentLoaded", function () {
			document.getElementById("searchInput").addEventListener("input", filterTable);
			document.getElementById("rowsPerPage").addEventListener("change", paginateTable);
			document.getElementById("startDate").addEventListener("change", filterTable);
			document.getElementById("endDate").addEventListener("change", filterTable);
			document.getElementById("sortFilter").addEventListener("change", sortTable);


			let statusDropdownItems = document.querySelectorAll(".dropdown-item[data-status]");
			let statusFilter = document.getElementById("statusFilter");

			statusDropdownItems.forEach(item => {
				item.addEventListener("click", function () {
					let selectedStatus = this.getAttribute("data-status");
					statusFilter.innerText = selectedStatus; // Update dropdown text
					statusFilter.setAttribute("data-selected-status", selectedStatus);
					filterTable();
				});
			});
		});


				function filterTable() {
			let searchText = document.getElementById("searchInput").value.toLowerCase();
			let selectedStatus = document.getElementById("statusFilter").getAttribute("data-selected-status") || "All";


			let startDate = document.getElementById("startDate").value ? new Date(document.getElementById("startDate").value).setHours(0, 0, 0, 0) : null;
			let endDate = document.getElementById("endDate").value ? new Date(document.getElementById("endDate").value).setHours(23, 59, 59, 999) : null;

			let table = document.getElementById("attendanceTable");
			let rows = table.getElementsByTagName("tr");

			for (let i = 1; i < rows.length; i++) {
				let row = rows[i];
				let cells = row.getElementsByTagName("td");
				let rowMatches = true;
				let statusCell = cells[2];
				let dateCell = cells[0];
				let rowDateText = dateCell.textContent.trim();


				let rowDate = new Date(rowDateText.split("/").reverse().join("-")).setHours(0, 0, 0, 0);


				let isDateInRange = (!startDate || rowDate >= startDate) && (!endDate || rowDate <= endDate);


				let rowTextMatchesSearch = Array.from(cells).some(cell => cell.textContent.toLowerCase().includes(searchText));

				let rowMatchesStatus = (selectedStatus === "All" || statusCell.textContent.trim().toLowerCase() === selectedStatus.toLowerCase());


				rowMatches = isDateInRange && rowTextMatchesSearch && rowMatchesStatus;

				row.style.display = rowMatches ? "" : "none";
			}
		}

			function sortTable() {
			const sortValue = document.getElementById("sortFilter").value;
			const table = document.getElementById("attendanceTable");
			const rows = Array.from(table.getElementsByTagName("tr")).slice(1);


			rows.sort((rowA, rowB) => {
				const cellA = rowA.getElementsByTagName("td")[1].textContent;
				const cellB = rowB.getElementsByTagName("td")[1].textContent;

				switch (sortValue) {
					case "asc":
						return cellA.localeCompare(cellB);
					case "desc":
						return cellB.localeCompare(cellA);
					case "recent":

						const dateA = new Date(rowA.getElementsByTagName("td")[0].textContent);
						const dateB = new Date(rowB.getElementsByTagName("td")[0].textContent);
						return dateB - dateA;
					case "last7Days":
					case "lastMonth":

						return 0;
					default:
						return 0;
				}
			});


			rows.forEach(row => table.appendChild(row));
		}


		function paginateTable() {
			let rowsPerPage = parseInt(document.getElementById("rowsPerPage").value);
			let table = document.getElementById("attendanceTable");
			let rows = table.getElementsByTagName("tr");

			let currentPage = 1;
			let startIndex = (currentPage - 1) * rowsPerPage + 1;
			let endIndex = startIndex + rowsPerPage;

			for (let i = 1; i < rows.length; i++) {
				rows[i].style.display = i >= startIndex && i < endIndex ? "" : "none";
			}
		}


	</script>



	<!-- Include Required Libraries -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.1/xlsx.full.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

	<script>
		// Export to Excel
		function exportToExcel() {
			// Get table element
			var table = document.getElementById("attendanceTable");

			// Convert table to worksheet
			var workbook = XLSX.utils.table_to_book(table, { sheet: "Attendance" });
			var excelFile = XLSX.write(workbook, { bookType: "xlsx", type: "binary" });

			// Convert binary string to blob and trigger download
			var blob = new Blob([s2ab(excelFile)], { type: "application/octet-stream" });
			var link = document.createElement("a");
			link.href = URL.createObjectURL(blob);
			link.download = "attendance.xlsx";
			link.click();
		}

		// Utility function to convert string to ArrayBuffer
		function s2ab(s) {
			var buf = new ArrayBuffer(s.length);
			var view = new Uint8Array(buf);
			for (var i = 0; i < s.length; i++) {
				view[i] = s.charCodeAt(i) & 0xFF;
			}
			return buf;
		}


		function exportToPDF() {
			const { jsPDF } = window.jspdf;
			var doc = new jsPDF();


			var table = document.getElementById("attendanceTable");


			doc.autoTable({ html: "#attendanceTable" });


			doc.save("attendance.pdf");
		}
	</script>

	<script>
			document.addEventListener("DOMContentLoaded", function () {
			let attendanceBtn = document.getElementById("attendanceBtn");
			let form = document.getElementById("attendanceForm");

			let today = new Date().toISOString().split('T')[0]; // Get today's date (YYYY-MM-DD)
			let loggedInUser = "@ViewData["LoggedInUser"]"; // User from the backend

			if (!loggedInUser) {
				console.error("No logged-in user found.");
				return;
			}

			// The status is now directly passed from the backend (ViewBag)
			let initialStatus = "@ViewBag.AttendanceStatus".trim();

			function updateButtonText(status) {
				console.log("Updating button text to:", status);
				attendanceBtn.innerText = status;
				attendanceBtn.disabled = (status === "Attendance Marked");
			}

			// Reset button text based on the attendance status
			if (initialStatus === "Attendance Marked") {
				updateButtonText("Attendance Marked");
			} else if (initialStatus === "Check-In") {
				updateButtonText("Check-In");
			} else if (initialStatus === "Lunch-In") {
				updateButtonText("Lunch-In");
			} else if (initialStatus === "Lunch-Out") {
				updateButtonText("Lunch-Out");
			} else if (initialStatus === "Check-Out") {
				updateButtonText("Check-Out");
			}

			// Handle form submission when the "Check-Out" button is clicked
			form.addEventListener("submit", async function (event) {
				if (attendanceBtn.innerText.trim() === "Check-Out") {
					event.preventDefault();

					if (confirm("Do you want to fill out your timesheet?")) {
						let formData = new FormData(form);

						try {
							let response = await fetch(form.action, {
								method: "POST",
								body: formData
							});

							if (response.ok) {
								// After successfully checking out, mark attendance as "Attendance Marked"
								updateButtonText("Attendance Marked");
								window.location.href = "/Timesheet/Timesheet";
							} else {
								alert("Error marking attendance. Please try again.");
							}
						} catch (error) {
							console.error("Error submitting attendance:", error);
							alert("An error occurred while marking attendance.");
						}
					}
				}
			});
		});

	</script>

</body>

</html>

