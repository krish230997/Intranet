
<div class="content">

	<!-- Breadcrumb -->
	<div class="d-md-flex d-block align-items-center justify-content-between page-breadcrumb mb-3">
		<div class="my-auto mb-2">
			<h2 class="mb-1">Payslip Report</h2>
			<nav>
				<ol class="breadcrumb mb-0">
					<li class="breadcrumb-item">
						<a href="index.html"><i class="ti ti-smart-home"></i></a>
					</li>
					<li class="breadcrumb-item">
						HR
					</li>
					<li class="breadcrumb-item active" aria-current="page">Payslip Report</li>
				</ol>
			</nav>
		</div>
		<div class="d-flex my-xl-auto right-content align-items-center flex-wrap ">
			<div class="mb-2">
				<div class="dropdown">
					<a href="javascript:void(0);" class="dropdown-toggle btn btn-white d-inline-flex align-items-center" data-bs-toggle="dropdown">
						<i class="ti ti-file-export me-1"></i>Export
					</a>
					<ul class="dropdown-menu  dropdown-menu-end p-3">
						<li>
							<a asp-action="ExportToPDF" asp-controller="PaySlipReport" class="dropdown-item rounded-1"><i class="ti ti-file-type-pdf me-1"></i>Export as PDF</a>
						</li>
						<li>
							<a asp-action="ExportToExcel" asp-controller="PaySlipReport" class="dropdown-item rounded-1"><i class="ti ti-file-type-xls me-1"></i>Export as Excel </a>
						</li>
					</ul>
				</div>

			</div>
			<div class="head-icons ms-2">
				<a href="javascript:void(0);" class="" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="Collapse" id="collapse-header">
					<i class="ti ti-chevrons-up"></i>
				</a>
			</div>
		</div>
	</div>
	<!-- /Breadcrumb -->

	<div class="row">

		<!-- Total Exponses -->
		<div class="col-xl-6 d-flex">
			<div class="row flex-fill">
				<div class="col-md-6 d-flex">
					<div class="card flex-fill">
						<div class="card-body">
							<div class="d-flex align-items-center justify-content-between bg-light border rounded p-2 mb-2">
								<div class="">
									<span class="fs-14 fw-normal text-truncate mb-1">Total Payroll</span>
									<h5>$@ViewBag.TotalSalary.ToString()</h5>
								</div>
								<a href="#" class="avatar avatar-md avatar-rounded bg-transparent-primary border border-primary">
									<span class="text-primary"><i class="ti ti-brand-shopee"></i></span>
								</a>
							</div>
							<p class="fs-12 fw-normal d-flex align-items-center text-truncate">
								<span class="text-success fs-12 d-flex align-items-center me-1">
									<i class="ti ti-arrow-wave-right-up me-1"></i>+20.01%
								</span> from last week
							</p>
						</div>
					</div>
				</div>
				<div class="col-md-6 d-flex">
					<div class="card flex-fill">
						<div class="card-body">
							<div class="d-flex align-items-center justify-content-between bg-light border rounded p-2 mb-2">
								<div class="">
									<span class="fs-14 fw-normal text-truncate mb-1">Deductions</span>
									<h5>$@ViewBag.TotalDeductions.ToString()</h5>
								</div>
								<a href="#" class="avatar avatar-md avatar-rounded bg-transparent-danger border border-danger">
									<span class="text-danger"><i class="ti ti-brand-shopee"></i></span>
								</a>
							</div>
							<p class="fs-12 fw-normal d-flex align-items-center text-truncate">
								<span class="text-success fs-12 d-flex align-items-center me-1">
									<i class="ti ti-arrow-wave-right-up me-1"></i>+17.01%
								</span> from last week
							</p>
						</div>
					</div>
				</div>
				<div class="col-md-6 d-flex">
					<div class="card flex-fill">
						<div class="card-body">
							<div class="d-flex align-items-center justify-content-between bg-light border rounded p-2 mb-2">
								<div class="">
									<span class="fs-14 fw-normal text-truncate mb-1">Net Pay</span>
									<h5>$@ViewBag.NetSalary.ToString()</h5>
								</div>
								<a href="#" class="avatar avatar-md avatar-rounded bg-transparent-success border border-success">
									<span class="text-success"><i class="ti ti-brand-shopee"></i></span>
								</a>
							</div>
							<p class="fs-12 fw-normal d-flex align-items-center text-truncate">
								<span class="text-success fs-12 d-flex align-items-center me-1">
									<i class="ti ti-arrow-wave-right-up me-1"></i>+10.01%
								</span> from last week
							</p>
						</div>
					</div>
				</div>
				<div class="col-md-6 d-flex">
					<div class="card flex-fill">
						<div class="card-body">
							<div class="d-flex align-items-center justify-content-between bg-light border rounded p-2 mb-2">
								<div class="">
									<span class="fs-14 fw-normal text-truncate mb-1">Earnings</span>
									<h5>$@ViewBag.Earnings.ToString()</h5>
								</div>
								<a href="#" class="avatar avatar-md avatar-rounded bg-transparent-skyblue border border-skyblue">
									<span class="text-skyblue"><i class="ti ti-brand-shopee"></i></span>
								</a>
							</div>
							<p class="fs-12 fw-normal d-flex align-items-center text-truncate">
								<span class="text-danger fs-12 d-flex align-items-center me-1">
									<i class="ti ti-arrow-wave-right-up me-1"></i>-10.01%
								</span> from last week
							</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- /Total Exponses -->
		<!-- Total Exponses -->
		<div class="col-xl-6 d-flex">
			<div class="card flex-fill">
				<div class="card-header border-0 pb-0">
					<div class="d-flex flex-wrap justify-content-between align-items-center">
						<div class="d-flex align-items-center ">
							<span class="me-2"><i class="ti ti-chart-area-line text-danger"></i></span>
							<h5>Payroll</h5>
						</div>
					</div>
				</div>
				<div class="card-body py-0">
					<div><canvas id="salaryChart"></canvas></div>

				</div>
			</div>
		</div>

		<div class="card">
			<div class="card-header d-flex align-items-center justify-content-between flex-wrap row-gap-3 custom-dropdown-spacing">
				<h5>Payslip List</h5>
				<div class="dropdown">
					<a href="javascript:void(0);" class="dropdown-toggle btn btn-white d-inline-flex align-items-center" data-bs-toggle="dropdown" data-filter="salary">
						Month
					</a>
					<ul class="dropdown-menu dropdown-menu-end p-3">
						<li><a href="javascript:void(0);" class="dropdown-item rounded-1">Jan-March</a></li>
						<li><a href="javascript:void(0);" class="dropdown-item rounded-1">April-Jun</a></li>
						<li><a href="javascript:void(0);" class="dropdown-item rounded-1">July-Sept</a></li>
						<li><a href="javascript:void(0);" class="dropdown-item rounded-1">Oct-Dec</a></li>
					</ul>
				</div>

				<div class="dropdown">
					<a href="javascript:void(0);" class="dropdown-toggle btn btn-white d-inline-flex align-items-center" data-bs-toggle="dropdown" data-filter="sort">
						Sort By : Last 7 Days
					</a>
					<ul class="dropdown-menu dropdown-menu-end p-3">
						<li><a href="javascript:void(0);" class="dropdown-item rounded-1">Ascending</a></li>
						<li><a href="javascript:void(0);" class="dropdown-item rounded-1">Descending</a></li>
					</ul>
				</div>
			</div>
		</div>

		<div class="card-body p-0">
			<div class="custom-datatable-filter table-responsive">
				<table class="table" id="payslipTable">
					<thead class="thead-light">
						<tr>
							<th>Payslip ID</th>
							<th>Name</th>
							<th>Paid Amount</th>
							<th>Paid Month</th>
							<th>Paid Year</th>
						</tr>
					</thead>
					<tbody>
						@foreach (var item in Model)
						{
							<tr>
								<td>@item.PayslipId</td>
								<td>
									<div class="d-flex align-items-center">
										<img src="/@item.ProfilePicture" alt="Profile" class="rounded-circle" width="40" height="40" />
										<div class="ms-2">
											<strong>@item.UserName</strong>
											@* <div class="text-muted">@(user != null ? user.Departments.Name : "No Department")</div> *@
										</div>
									</div>
								</td>
								<td>@item.PaidAmount</td>
								<td>@item.PaidMonth</td>
								<td>@item.PaidYear</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>



		<div class="footer d-sm-flex align-items-center justify-content-between border-top bg-white p-3">
			<p class="mb-0">2014 - 2025 &copy; SmartHR.</p>
			<p>Designed &amp; Developed By <a href="javascript:void(0);" class="text-primary">Dreams</a></p>
		</div>

		@section Scripts
  {
			<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
			<script>
				fetch('@Url.Action("GetSalaryGraphData", "PaySlipReport")')
				   .then(response => response.json())
				   .then(data => {
					   console.log(data);
					   // Prepare the labels (years) and salaries for the chart
					   const labels = data.map(item => item.year);
					   const salaries = data.map(item => item.totalSalary);

					   // Create the chart
					  const ctx = document.getElementById('salaryChart').getContext('2d');
					   const salaryChart = new Chart(ctx, {
						   type: 'line', // Use 'line' chart for the step graph
						   data: {
							   labels: labels,
							   datasets: [{
								   label: 'Total Salary',
								   data: salaries,
								   fill: false,  // Do not fill the area under the line
								   backgroundColor: 'rgba(255, 99, 132, 0.2)', // Red color with transparency
								 borderColor: 'rgba(255, 99, 132, 1)',
								  borderWidth: 5,
								   lineTension: 0, // For step-like lines (no curve)
								   stepped: true,  // Enable step graph
							   }]
						   },
						   options: {
							   scales: {
								   y: {
									   beginAtZero: true
								   }
							   }
						   }
					   });
				   })
				   .catch(error => console.error('Error fetching salary data:', error));
			</script>
			<script>

							$(document).ready(function () {
					$(".dropdown-item").click(function () {
						var filterType = $(this).closest(".dropdown").find("a").attr("data-filter");
						var selectedValue = $(this).text().trim();

						var monthFilter = "";
						var sortOrder = "";

						// Check if we clicked on the Month filter or the Sort filter
						if (filterType === "salary") {
							monthFilter = selectedValue;
						} else if (filterType === "sort") {
							sortOrder = selectedValue;
						}

						// Send AJAX request with monthFilter and sortOrder
						$.ajax({
							url: '@Url.Action("Index", "PaySlipReport")',  // Make sure the correct controller action is targeted
							type: 'GET',
							data: {
								monthFilter: monthFilter,  // Pass the month filter
								sortOrder: sortOrder       // Pass the sort order
							},
							success: function (data) {
								// Update the table with the filtered data
								$("#payslipTable tbody").html($(data).find("#payslipTable tbody").html());
							},
							error: function (xhr, status, error) {
								console.error("AJAX request failed: ", status, error);
							}
						});
					});
				});


			</script>



			<!-- DataTables CSS -->
			<link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">

			<!-- jQuery & DataTables JS -->
			<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
			<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

			<script>
				$(document).ready(function () {
					$('#payslipTable').DataTable({
						"processing": true,
						"serverSide": false, // Set to true if implementing AJAX-based DataTables
						"paging": true,
						"searching": true,
						"ordering": true,
						"lengthMenu": [5, 10, 25, 50], // Rows per page
						"language": {
						"search": "Search Employee:",
						"lengthMenu": "Show _MENU_ records per page",
						"info": "Showing _START_ to _END_ of _TOTAL_ payslips"
						}
					});
				});
			</script>

		}
